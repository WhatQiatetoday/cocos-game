{"version":3,"sources":["file:///G:/code/cocos%E7%BB%83%E4%B9%A0/explosionPoint/assets/scripts/game.ts"],"names":["_decorator","Component","Contact2DType","director","Input","input","Label","Node","ParticleSystem2D","PhysicsSystem2D","RigidBody2D","Sprite","tween","UITransform","v3","Vec2","view","ccclass","property","NewComponent","type","height","fireStatus","fallSlowly","fireTo","score","start","placePlayer","placeEnemy","on","EventType","TOUCH_START","fire","onDestroy","off","update","deltaTime","instance","BEGIN_CONTACT","onBeginContact","getVisibleSize","console","log","playerNode","setPosition","to","position","getComponent","contentSize","y","call","die","enemyNode","active","x","width","Math","random","duration","t1","t2","sequence","repeatForever","stop","tweenDuration","onComplete","boom","color","scheduleOnce","loadScene","pos","boomNode","particle","undefined","startColor","resetSystem","sleep","roleNode","rigidBody","linearVelocity","ZERO","angularVelocity","result","labelNode","string","toString"],"mappings":"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","sourcesContent":["import { _decorator, Canvas, Collider2D, Color, Component, Contact2DType, director, find, Input, input, Label, Node, ParticleSystem, ParticleSystem2D, PhysicsSystem2D, RigidBody2D, Sprite, sys, Tween, tween, TweenAction, TweenSystem, UITransform, v2, v3, Vec2, Vec3, view } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('NewComponent')\nexport class NewComponent extends Component {\n    // 绑定玩家节点\n    @property({type: Node})\n    playerNode: Node = null\n    @property({type: Node})\n    boomNode: Node = null\n    @property({type: Node})\n    enemyNode: Node = null\n    @property({type: Label})\n    labelNode: Label = null\n    height: number = 0\n    fireStatus: boolean = false\n    fallSlowly: Tween<Node> = null\n    fireTo: Tween<Node> = null\n    score: number = 0\n\n    // onLoad(){\n    //     this.enemyNode = find('Canvas/enemy')\n    // }\n\n    start() {\n        this.placePlayer()\n        this.placeEnemy()\n        this.fireStatus = false\n        // 绑定点击事件\n        input.on(Input.EventType.TOUCH_START, this.fire, this);\n        \n\n    }\n    // 销毁绑定事件\n    onDestroy () {\n        input.off(Input.EventType.TOUCH_START, this.fire, this);\n    }\n    update(deltaTime: number) {\n        // 注册全局碰撞回调函数\n        if (PhysicsSystem2D.instance) {\n            PhysicsSystem2D.instance.on(Contact2DType.BEGIN_CONTACT, this.onBeginContact, this);\n            // PhysicsSystem2D.instance.on(Contact2DType.PRE_SOLVE, this.onPreSolve, this);\n        }\n    }\n\n    placePlayer(){\n        // 获取屏幕可见区域的宽高\n        this.height = view.getVisibleSize().height\n        console.log(this.height,\"高度\")\n        this.playerNode.setPosition(v3(0,-this.height/4))\n\n        // 如果10s之后玩家还没有操作，那么英雄掉落，游戏结束\n        this.fallSlowly = tween(this.playerNode).to(10,{\n            position:v3(0,-this.height/2+this.playerNode.getComponent(UITransform).contentSize.y)\n        }).call(()=>{\n            this.die()\n        }).start()\n    }\n\n    placeEnemy(){\n        this.enemyNode.active = true\n        let x = view.getVisibleSize().width/2 - this.enemyNode.getComponent(UITransform).contentSize.x/2\n        let y = Math.random() * view.getVisibleSize().height/4\n        let duration = 0.6 + Math.random() * 0.5\n        this.enemyNode.setPosition(0,view.getVisibleSize().height/3)\n        let t1 = tween(this.enemyNode).to(duration,{\n            position: v3(-x,y)\n        })\n        let t2 = tween(this.enemyNode).to(duration,{\n            position: v3(x,y)\n        })\n        // 整合t1，t2两个缓动\n        tween(this.enemyNode).sequence(t1,t2).repeatForever().start()\n    }\n\n    // 发射\n    fire(){\n        if(this.fireStatus) return\n        this.fireStatus = true\n        // 停止掉落动画\n        this.fallSlowly.stop()\n        let tweenDuration = 0.6\n        this.fireTo = tween(this.playerNode).to(tweenDuration,{\n            position:v3(0,this.height/2)\n        },{\n            onComplete:()=>{\n                this.die()\n            }\n        }).start()\n    }\n\n    die(){\n        console.log('游戏结束!!!')\n        this.playerNode.active = false\n        this.boom(this.playerNode.position,this.playerNode.getComponent(Sprite).color)\n        // 延时1s后执行,且只执行一次\n        // 重新加载游戏场景，游戏重新开始\n        this.scheduleOnce(()=> {\n            director.loadScene('gameOver')\n        }, 1)\n    }\n\n    // 撞击爆炸操作\n    boom(pos: Vec3,color: Color){\n        console.log(this.boomNode + \"boomnode\")\n        console.log(pos)\n        this.boomNode.setPosition(pos)\n        let particle = this.boomNode.getComponent(ParticleSystem2D)\n        if(color !== undefined){\n            particle.startColor = color\n        }\n        particle.resetSystem()\n    }\n    sleep(roleNode: Node){\n        let rigidBody = roleNode.getComponent(RigidBody2D)\n        // 设置刚体的线速度和角速度为0，使其进入睡眠状态\n        rigidBody.linearVelocity = Vec2.ZERO;\n        rigidBody.angularVelocity = 0;\n    }\n    // 碰撞后触发函数\n    onBeginContact(){\n        console.log('开始碰撞')\n        this.fireTo.stop()\n        this.boom(this.enemyNode.position,this.enemyNode.getComponent(Sprite).color)\n        this.enemyNode.active = false\n        let result = ++this.score\n        this.labelNode.string = result.toString()\n        \n        // this.placeEnemy()\n        this.scheduleOnce(()=>{\n            this.sleep(this.playerNode)\n            this.sleep(this.enemyNode)\n            // this.placePlayer()\n            // this.placeEnemy()\n            this.fireStatus = false\n        },1)\n    }\n}\n\n"]}