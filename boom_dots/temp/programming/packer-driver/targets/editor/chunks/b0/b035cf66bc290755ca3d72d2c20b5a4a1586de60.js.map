{"version":3,"sources":["file:///G:/code/cocos%E7%BB%83%E4%B9%A0/explosionPoint/assets/scripts/game.ts"],"names":["_decorator","Component","director","find","Input","input","Node","ParticleSystem2D","Sprite","tween","UITransform","v3","view","ccclass","property","NewComponent","type","height","fireStatus","fallSlowly","onLoad","particle","boomNode","getComponent","stopSystem","start","placePlayer","on","EventType","TOUCH_START","fire","onDestroy","off","update","deltaTime","getVisibleSize","console","log","playerNode","setPosition","to","position","contentSize","y","call","die","stop","tweenDuration","onComplete","active","boom","color","scheduleOnce","loadScene","newNode1","parent","pos","undefined","startColor"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, director, find, Input, input, Node, ParticleSystem, ParticleSystem2D, Sprite, Tween, tween, TweenAction, TweenSystem, UITransform, v3, Vec3, view } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('NewComponent')\nexport class NewComponent extends Component {\n    // 绑定玩家节点\n    @property({type: Node})\n    playerNode: Node = null\n    @property({type: Node})\n    boomNode: Node = null\n    height: number = 0\n    fireStatus: boolean = false\n    fallSlowly: Tween<Node> = null\n\n    protected onLoad(): void {\n        let particle = this.boomNode.getComponent(ParticleSystem2D);\n        particle.stopSystem();\n    }\n    start() {\n        this.placePlayer()\n        this.fireStatus = false\n        // 绑定点击事件\n        input.on(Input.EventType.TOUCH_START, this.fire, this);\n    }\n    // 销毁绑定事件\n    onDestroy () {\n        input.off(Input.EventType.TOUCH_START, this.fire, this);\n    }\n    update(deltaTime: number) {\n        \n    }\n\n    placePlayer(){\n        // 获取屏幕可见区域的宽高\n        this.height = view.getVisibleSize().height\n        console.log(this.height,\"高度\")\n        this.playerNode.setPosition(v3(0,-this.height/4))\n\n        // 如果10s之后玩家还没有操作，那么英雄掉落，游戏结束\n        this.fallSlowly = tween(this.playerNode).to(10,{\n            position:v3(0,-this.height/2+this.playerNode.getComponent(UITransform).contentSize.y)\n        }).call(()=>{\n            this.die()\n        }).start()\n    }\n\n    // 发射\n    fire(){\n        if(this.fireStatus) return\n        this.fireStatus = true\n        // 停止掉落动画\n        this.fallSlowly.stop()\n        let tweenDuration = 0.6\n        tween(this.playerNode).to(tweenDuration,{\n            position:v3(0,this.height/2)\n        },{\n            onComplete:()=>{\n                this.die()\n            }\n        }).start()\n    }\n\n    die(){\n        console.log('游戏结束!!!')\n        this.playerNode.active = false\n        this.boom(this.playerNode.position,this.playerNode.getComponent(Sprite).color)\n        // 延时1s后执行,且只执行一次\n        // 重新加载游戏场景，游戏重新开始\n        this.scheduleOnce(()=> {\n            // 这里的 this 指向 component\n            director.loadScene('game',()=>{\n                // 重新绑定需要保留的节点\n                const newNode1 = find(\"Canvas/boom\")\n                console.log(newNode1)\n                console.log(\"新绑定的节点\")\n                    // 进行节点绑定的判断和处理\n                if (newNode1 && this.boomNode) {\n                    this.boomNode.parent = newNode1.parent;\n                    this.boomNode.position = newNode1.position;\n                }\n            })\n        }, 1)\n    }\n\n    // 爆炸操作\n    boom(pos: Vec3,color: Color){\n        console.log(this.boomNode + \"boomnode\")\n        this.boomNode.setPosition(pos)\n        let particle = this.boomNode.getComponent(ParticleSystem2D)\n        if(color !== undefined){\n            particle.startColor = color\n        }\n        this.boomNode.active = true\n        console.log('爆炸了')\n    }\n}\n\n"]}