{"version":3,"sources":["file:///G:/code/cocos%E7%BB%83%E4%B9%A0/explosionPoint/assets/scripts/game.ts"],"names":["_decorator","Component","director","Input","input","Node","ParticleSystem2D","Sprite","tween","UITransform","v3","view","ccclass","property","NewComponent","type","height","fireStatus","fallSlowly","start","placePlayer","placeEnemy","on","EventType","TOUCH_START","fire","onDestroy","off","update","deltaTime","playerNode","position","subtract","enemyNode","x","getComponent","contentSize","boom","color","getVisibleSize","console","log","setPosition","to","y","call","die","width","Math","random","duration","t1","t2","sequence","repeatForever","stop","tweenDuration","onComplete","active","scheduleOnce","loadScene","error","newNode1","pos","boomNode","particle","undefined","startColor","resetSystem"],"mappings":"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","sourcesContent":["import { _decorator, Canvas, Color, Component, director, find, Input, input, Node, ParticleSystem, ParticleSystem2D, Sprite, sys, Tween, tween, TweenAction, TweenSystem, UITransform, v3, Vec3, view } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('NewComponent')\nexport class NewComponent extends Component {\n    // 绑定玩家节点\n    @property({type: Node})\n    playerNode: Node = null\n    @property({type: Node})\n    boomNode: Node = null\n    @property({type: Node})\n    enemyNode: Node = null\n    height: number = 0\n    fireStatus: boolean = false\n    fallSlowly: Tween<Node> = null\n\n    // onLoad(){\n    //     this.enemyNode = find('Canvas/enemy')\n    // }\n\n    start() {\n        this.placePlayer()\n        this.placeEnemy()\n        this.fireStatus = false\n        // 绑定点击事件\n        input.on(Input.EventType.TOUCH_START, this.fire, this);\n    }\n    // 销毁绑定事件\n    onDestroy () {\n        input.off(Input.EventType.TOUCH_START, this.fire, this);\n    }\n    update(deltaTime: number) {\n        if(this.playerNode.position.subtract(this.enemyNode.position).x < this.playerNode.getComponent(UITransform).contentSize.x/2 + this.enemyNode.getComponent(UITransform).contentSize.x/2){\n            this.boom(this.enemyNode.position,this.enemyNode.getComponent(Sprite).color)\n        }\n    }\n\n    placePlayer(){\n        // 获取屏幕可见区域的宽高\n        this.height = view.getVisibleSize().height\n        console.log(this.height,\"高度\")\n        this.playerNode.setPosition(v3(0,-this.height/4))\n\n        // 如果10s之后玩家还没有操作，那么英雄掉落，游戏结束\n        this.fallSlowly = tween(this.playerNode).to(10,{\n            position:v3(0,-this.height/2+this.playerNode.getComponent(UITransform).contentSize.y)\n        }).call(()=>{\n            this.die()\n        }).start()\n    }\n\n    placeEnemy(){\n        let x = view.getVisibleSize().width/2 - this.enemyNode.getComponent(UITransform).contentSize.x/2\n        let y = Math.random() * view.getVisibleSize().height/4\n        let duration = 0.6 + Math.random() * 0.5\n        this.enemyNode.setPosition(0,view.getVisibleSize().height/3)\n        let t1 = tween(this.enemyNode).to(duration,{\n            position: v3(-x,y)\n        })\n        let t2 = tween(this.enemyNode).to(duration,{ \n            position: v3(x,y)\n        })\n        // 整合t1，t2两个缓动\n        tween(this.enemyNode).sequence(t1,t2).repeatForever().start()\n    }\n\n    // 发射\n    fire(){\n        if(this.fireStatus) return\n        this.fireStatus = true\n        // 停止掉落动画\n        this.fallSlowly.stop()\n        let tweenDuration = 0.6\n        tween(this.playerNode).to(tweenDuration,{\n            position:v3(0,this.height/2)\n        },{\n            onComplete:()=>{\n                this.die()\n            }\n        }).start()\n    }\n\n    die(){\n        console.log('游戏结束!!!')\n        this.playerNode.active = false\n        this.boom(this.playerNode.position,this.playerNode.getComponent(Sprite).color)\n        // 延时1s后执行,且只执行一次\n        // 重新加载游戏场景，游戏重新开始\n        this.scheduleOnce(()=> {\n            // 重新绑定需要保留的节点\n            // const newNode1 = this.boomNode.parent\n            // sys.localStorage.setItem(\"node\",newNode1)\n            // console.log(newNode1)\n            // console.log(\"新绑定的节点\")\n\n            director.loadScene('gameOver',(error,newNode1)=>{\n            // 进行节点绑定的判断和处理\n            if (newNode1) {\n                // this.boomNode.parent = newNode1.parent;\n                // this.boomNode.position = newNode1.position;\n                console.log(newNode1)\n            }\n            })\n        }, 1)\n    }\n\n    // 撞击爆炸操作\n    boom(pos: Vec3,color: Color){\n        console.log(this.boomNode + \"boomnode\")\n        this.boomNode.setPosition(pos)\n        let particle = this.boomNode.getComponent(ParticleSystem2D)\n        if(color !== undefined){\n            particle.startColor = color\n        }\n        particle.resetSystem()\n        console.log('爆炸了')\n    }\n}\n\n"]}